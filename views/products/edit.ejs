<% layout('./layouts/boilerplate') %>
<%- include("../partials/navbar") %>

<div class="row">
    <div class="form-header">
        <h2><i class="bi bi-pencil-square me-2"></i>Edit Product</h2>
        <p>Update the product details below</p>
    </div>
    
    <a href="/products" class="back-button">
        <i class="bi bi-arrow-left me-1"></i>Back to Products
    </a>

    <form action="/product/<%= foundProduct._id %>?_method=PATCH" method="post" class="edit-product-form">
        <!-- Image Preview -->
        <div class="image-preview-container">
            <img src="<%= foundProduct.img %>" alt="Current Product Image" class="image-preview" id="imagePreview">
            <p class="text-muted mt-2">Current Product Image</p>
        </div>

        <div class="form-group">
            <label for="name">Product Name</label>
            <input type="text" id="name" name="name" value="<%= foundProduct.name %>" 
                   placeholder="Enter product name" required>
        </div>
        
        <div class="form-group">
            <label for="img">Image URL</label>
            <input type="text" id="img" name="img" value="<%= foundProduct.img %>" 
                   placeholder="https://example.com/image.jpg" 
                   onchange="updateImagePreview(this.value)" required>
        </div>
        
        <div class="form-group">
            <label for="price">Price (â‚¹)</label>
            <input type="number" id="price" name="price" value="<%= foundProduct.price %>" 
                   placeholder="Enter price" min="0" step="0.01" required>
        </div>
        
        <div class="form-group">
            <label for="desc">Description</label>
            <textarea name="desc" id="desc" rows="4" 
                      placeholder="Describe your product..." 
                      oninput="updateCharCount(this)" required><%= foundProduct.desc %></textarea>
            <div class="char-count">
                <span id="charCount">0</span>/500
            </div>
        </div>
        
        <button type="submit" class="btn-success" id="submitBtn">
            <i class="bi bi-check-circle me-1"></i>
            Update Product
        </button>
    </form>
</div>

<script>
// Update image preview
function updateImagePreview(url) {
    const preview = document.getElementById('imagePreview');
    preview.src = url;
    preview.onerror = function() {
        this.src = 'https://via.placeholder.com/200x200?text=Invalid+Image+URL';
    }
}

// Character count for description
function updateCharCount(textarea) {
    const charCount = document.getElementById('charCount');
    charCount.textContent = textarea.value.length;
    
    if (textarea.value.length > 500) {
        charCount.style.color = '#e74c3c';
    } else if (textarea.value.length > 400) {
        charCount.style.color = '#f39c12';
    } else {
        charCount.style.color = '#27ae60';
    }
}

// Initialize character count on page load
document.addEventListener('DOMContentLoaded', function() {
    const descTextarea = document.getElementById('desc');
    updateCharCount(descTextarea);
    
    // Initialize image preview
    updateImagePreview('<%= foundProduct.img %>');
});

// Form submission loading state
document.querySelector('form').addEventListener('submit', function(e) {
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.classList.add('btn-loading');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="bi bi-arrow-repeat me-1"></i>Updating...';
});
</script>

</body>
</html>